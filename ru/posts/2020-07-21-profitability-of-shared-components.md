# Измеряем пользу повторного использования

Сначала немного истории.

Собственная верстка в Яндексе началась в 2005 году с приходом Виталия Харисова (до этого верстку делали в Студии Лебедева).
Где-то через год стала зарождаться общая библиотека компонентов.

Сначала она жила прямо на dev-сервере, потом, как полагается, поехала в svn. Первый коммит во внутреннюю библиотеку Лего датируется 25 апреля 2008 года.

С тех пор мы успели изобрести [самую популярную в мире методологию верстки](https://ru.bem.info/methodology/), создать целую платформу для разработки фронтенда и несколько раз переписать Лего практически с нуля.

Сейчас Лего используется в нескольких сотнях репозиториев от Поиска до админок экспериментальных бизнес-юнитов.

Но до сих пор мы не умели отвечать на простой вопрос: **точно ли делать универсальный общий компонент выгоднее, чем быстро написать на коленке несколько аналогичных прямо на сервисах**?

Вернее мы уверенно отвечали, что, конечно, выгоднее, но доказать не могли.

Чтобы не быть совсем голословными, мы приводили множество всяких чисел:
* количество скачиваний общей библиотеки
* количество посещений внутреннего сайта документации (Метрика говорит, что у нас 850+ уникальных читателей в месяц)
* количество уникальных активных коммитеров в репозитории, где используется Лего (~500 человек, это абсолютное большинство фронтендеров компании)
* количество использований компонентов (тысячи их)
* результаты опросов наших пользователей
и так далее.

Наконец-то мы вывели **метрику рентабельности создания общих компонентов**.

Идея на самом деле очень простая:

![](https://github.com/tadatuta/tadatuta.com/blob/master/ru/posts/lego-metrics.png?raw=true)

* Количество внедрений — это сумма всех фактических внедрений для какого-либо компонента/фичи/улучшения.
* Стоимость разработки — средняя стоимость данной фичи, если бы её реализовывали прямо на целевом сервисе.
* Стоимость внедрения — средняя стоимость внедрения готового компонента на сервис.
* Стоимость унификации — это сумма всех трудозатрат на разработку универсального решения (сбор требований со всех заинтересованных, собственно разработка, написание документации и т.п.).

Например, если у нас 3 потенциально заинтересованных сервиса, стоимость разработки = 5 человеко-дней, стоимость внедрения = 2 дня, а создание общего компонента обойдется в 3 раза дороже, чем сделать его специфичную версию сразу на сервисе, то окажется, что делать общее решение на 30% дороже, чем трижды написать подобную фичу на каждом сервисе заново:

![](https://github.com/tadatuta/tadatuta.com/blob/master/ru/posts/lego07.png?raw=true)

Однако, если заинтересованных сервисов будет 100, а стоимость внедрения удастся сократить до 4 часов (пусть и за счет дополнительных усилий при создании общего компонента), то в таком случае **создание общего компонента будет уже в 7 раз выгоднее**:

![](https://github.com/tadatuta/tadatuta.com/blob/master/ru/posts/lego7.png?raw=true)

Метрика достаточно универсальная, чтобы с её помощью планировать и ранжировать как задачи непосредстенно в команде Лего (включая инфраструктурные), так и унификацию общих компонентов силами разработчиков сервисов.
